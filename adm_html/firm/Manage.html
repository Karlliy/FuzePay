<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title><?php echo Base_Company?></title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">
<link href="../adm_html/css/bootstrap-override.css" rel="stylesheet" type="text/css" />
<script src="../jquery/jquery-1.8.3.js" type="text/javascript"></script>
<script type='text/javascript' src='../adm_html/scripts/firm.js'></script>
<script type="text/javascript">
	var Sort = "";
	
	function AnewSort() {
	
	$('#tabledata').each(function () {
		//console.log('123');
		if (Sort == "" || Sort == -1) {
			Sort = 1;
			$('.icon-caret-square-o-up').remove();
			$('.icon-caret-square-o-down').remove();
			$('#TotalSort').append("<i class='icon-caret-square-o-up' style='font-size:16px'></i>");
			$(this).find('#Store_SysInfoList > tr').sort(function (a, b) {			
				console.log(a.dataset.sort.toString());
				return (a.dataset.sort.toString() < b.dataset.sort.toString()) ? 1 : -1;    ;
			 }).appendTo($(this));
		}else {
			Sort = -1;
			$('.icon-caret-square-o-up').remove();
			$('.icon-caret-square-o-down').remove();
			$('#TotalSort').append("<i class='icon-caret-square-o-down' style='font-size:16px'></i>");
			$(this).find('#Store_SysInfoList > tr').sort(function (a, b) {			
				//console.log(parseInt($(a).attr('data-sort')));
				return (a.dataset.sort.toString() > b.dataset.sort.toString()) ? 1 : -1; 
			 }).appendTo($(this));
		}
		
	});
}

	function jBox(url) {
		$.jBox("iframe:" + url, {
			top: 50,
			id: 'user',
			title: null,
			iframeScrolling: 'yes',
			showScrolling: true,
			width: 800,
			height: 720,
			buttons: {
				'關閉': '關閉'
			}
		});
	}

	function jBox2(url) {
		$.jBox("iframe:" + url, {
			top: 50,
			border: 50, 
			id: 'user',
			title: null,
			iframeScrolling: 'yes',
			showScrolling: true,
			width: 1000,
			height: 'auto',
			loaded: function (h) { 
			if ($('#jbox-iframe').contents().find('#form').height() > $(window).height() - 50) {
					$('#jbox-iframe').css('height',  $(window).height() - 200);
				}else {
					$('#jbox-iframe').css('height', $('#jbox-iframe').contents().find('#form').height());
				}
				console.log($(window).height() + "|"+ $('#jbox-iframe').contents().find('#form').height()); 
			},
			buttons: {}
		});
	}
	$(document).ready(function() {
		AnewSort();
		new jBox('Confirm', {
			content: '您確定要刪除?',
			confirmButton: '確定刪除!',
			cancelButton: '取消'
		});
	});
</script>
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">
  
      <!-- Sidebar -->
      <?php include_once( "../adm_html/menu.html");?>
      <!-- End of Sidebar -->
  
      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
          <!-- Topbar -->
          <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
            <!-- Sidebar Toggle (Topbar) -->
            <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
              <i class="fa fa-bars"></i>
            </button>
            <!-- Topbar Search -->
            <h4 style="color: #0f7c5e;font-weight:900;">商戶資料</h4>
            <!-- Topbar Navbar -->
          </nav>
          <!-- End of Topbar -->
          <div class="container-fluid">
            <!-- DataTales Example -->
            <div class="card shadow mb-4">
              <form id="form1" name="form1" method="post" action="">
                <div class="card-header py-3">
                  <div class="panel-body">
                    <label>搜尋: </label>
                    &nbsp;&nbsp;
                    <input name='Keyword' type='text' class="form-control field" id="Keyword" maxlength="50"
                      style="width:160px;" placeholder="特店登記名稱或負責人 " />
                    &nbsp;&nbsp;
                    <input type="submit" name="button" id="button" class="pull btn btn-info btn" value=" 搜 尋 " />
                    <?php if ((CSession::getVar("IsChild") == 0 || (CSession::getVar("IsChild") == 1 &&  array_search("FirmAdd", CSession::getVar("Purview")) != false)) && CSession::getVar("AdminLevel") <= 2) {?>
                    <div class="cnavbar" style="float:right;"> <span class="pull-right btn btn-info btn" rel="tooltip"
                        title="更改搜尋條件" id="CaseReq"
                        onclick="javascript:jBox2('<?php echo $_SERVER[" PHP_SELF "] ?>?func=Added');"> <i
                          class="icon-edit"></i> 新增廠商資料</span> </div>
                    <?php }?>
                  </div>
                </div>
              </form>
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="row bu_title_bar clearfix">
                    <h4 class="pull-left">共 <span id="lStore_SysInfoTotal"
                        class="searchresults_count"><?php echo count($Html)?></span> 筆</h4>
                  </div>
                  <div class="row clearfix">
                      <div class="table-responsive">
                      <table id="tabledata" class="table table-bordered dataTable">
                        <thead>
                          <tr>
                            <th class="nowrap" style="width: 100px">編號</th>
                            <th class="nowrap" style="width: 150px">廠商名稱</th>
                            <th class="nowrap" style="width: 150px">特店代號<a href="javascript:void(0)" id="TotalSort"
                                onClick="AnewSort()"> </a></th>
                            <th class="nowrap" style="width: 150px">業務窗口</th>
                            <th class="nowrap" style="width: 150px">電話</th>
                            <th class="nowrap" style="width: 150px">合約到期日</th>
                            <?php if ($AdminLevel == "1" || $AdminLevel == "2") {?>
                            <th class="nowrap" style="width: 150px"></th>
                            <?php }?>
                          </tr>
                        </thead>
                        <?php $RowIndex = 1;?>
                        <?php foreach ((array)$Html as $key=> $value){?>
                        <tbody id="Store_SysInfoList">
                          <tr data-sort="<?php echo $value["FirmCode"]?>">
                            <td class="nowrap" <?php echo $value["background"]?>><?php echo $RowIndex?></td>
                            <td class="nowrap" <?php echo $value["background"]?>><?php echo $value["Name"]?></td>
                            <td class="nowrap" <?php echo $value["background"]?>><?php echo $value["FirmCode"]?></td>
                            <td class="nowrap" <?php echo $value["background"]?>><?php echo $value["Window"]?></td>
                            <td class="nowrap" <?php echo $value["background"]?>><?php echo $value["TEL"]?></td>
                            <td class="nowrap" <?php echo $value["background"]?>><?php echo $value["ContractDate"]?></td>
                            <?php if ($AdminLevel == "1" || $AdminLevel == "2") {?>
                            <td class="nowrap">
                              <?php if ((CSession::getVar("IsChild") == 0 || (CSession::getVar("IsChild") == 1 && array_search("FirmEdit", CSession::getVar("Purview")) != false)) && CSession::getVar("AdminLevel") <= 2) {?>
                              <a href="javascript:;" class="btn btn-info btn-small" id="EditJBox"
                                onclick="javascript:jBox2('<?php echo $_SERVER[" PHP_SELF "] ?>?func=Modify&Sno=<?php echo $value['Sno']; ?>');"><i
                                  class="icon-edit"></i> 編修</a>
                              <?php }?>
                              <?php if ((CSession::getVar("IsChild") == 0 || (CSession::getVar("IsChild") == 1 && array_search("FirmDel", CSession::getVar("Purview")) != false))&& CSession::getVar("AdminLevel") <= 2) {?>
                              <a href="javascript:;" class="btn btn-info btn-small MCaseFa" id="DELJBox" data-confirm
                                onclick="new jBox('', {content: document.location='<?php echo $value['DelLink']; ?>', color: 'green', attributes: {y: 'bottom'}})"><i
                                  class="icon-remove"></i> 刪除</a>
                              <?php }?>
        
                              <a href="javascript:;" class="btn btn-info btn-small MCaseFa" id="SETCommissionJBox"
                                style="display:none"
                                onclick="javascript:jBox2('<?php echo $_SERVER[" PHP_SELF "] ?>?func=SetCommission&Sno=<?php echo $value['Sno']; ?>');"><i
                                  class="icon-edit"></i> 設定交易手續費</a>
                              <?php if ((CSession::getVar("IsChild") == 0 || (CSession::getVar("IsChild") == 1 && array_search("ChargeSet", CSession::getVar("Purview")) != false)) && CSession::getVar("AdminLevel") <= 2) {?>
                              <a href="javascript:;" class="btn btn-info btn-small MCaseFa" id="SETInterfacedJBox"
                                style="display:none"
                                onclick="javascript:jBox2('<?php echo $_SERVER[" PHP_SELF "] ?>?func=SetInterfaced&Sno=<?php echo $value['Sno']; ?>');"><i
                                  class="icon-edit"></i> 設定系統介接</a>
        
                              <a href="javascript:;" class="btn btn-info btn-small MCaseFa" id="SetRefusalJBox"
                                style="display:none"
                                onclick="javascript:jBox2('<?php echo $_SERVER[" PHP_SELF "] ?>?func=SetRefusalIP&Sno=<?php echo $value['Sno']; ?>');"><i
                                  class="icon-edit"></i> 拒絕交易IP設定</a>
                              <?php }?>
                            </td>
                            <?php }?>
                          </tr>
                        </tbody>
                        <?php $RowIndex++;?>
                        <?php }?>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      <!-- End of Main Content -->
      <!-- Footer -->
      <?php include_once( "../adm_html/footer.html");?>
      <!-- End of Footer -->
    </div>
    <!-- End of Content Wrapper -->
  </div>
  <!-- End of Page Wrapper -->
</body>
</html>
