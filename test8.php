<?php

    //$_Data = "715108202019100408075874N0000000000500000010010820092495662";
    //$_Data = "715108202019100408185845T0000000000300000010010820092473657";
    /*$_Data = "715108202019101414906126R0000000000050000010010820101462301";
    $_VatmAccount = substr($_Data, -14);
    echo $_VatmAccount."<br />";

    $_Amt = substr($_Data, 25, 13);
    echo $_Amt."<br />";

    $_TX = substr($_Data, 16, 8);
    echo $_TX."<br />";

    $_DATE = substr($_Data, 8, 8);
    echo Date('Y-m-d', strtotime($_DATE))."<br />";*/
    //echo date('Y-m-d H:i:s', strtotime("20191002173459"));
    /*$XMLData = "<CONFIRMDATA><MMK_ID>GFN</MMK_ID><TEN_CODE>0821</TEN_CODE><TRAN_NO>19120106006</TRAN_NO><STATUS_CODE>0000</STATUS_CODE><STATUS_DESC></STATUS_DESC><LISTDATA><DATA_1>WP912057219781</DATA_1><DATA_2>50</DATA_2><DATA_3>智慧付</DATA_3><DATA_4>20191205</DATA_4><DATA_5>175700</DATA_5><DATA_6></DATA_6><DATA_7></DATA_7><DATA_8></DATA_8></LISTDATA></CONFIRMDATA>";
    $parameter = array(	
        "XMLData"		=> iconv("UTF-8","big5", $XMLData)
    );*/
    $XMLData = '<?xml version="1.0" encoding="big5"?><MYB2B><HEADER><TXNO>2021051115260445</TXNO><SecureFunc>1</SecureFunc></HEADER><BODY><DATA>79006200730068003900380063003800700066003200720072003700390052003100440078004E0045006300750055002B0071003300730050005900510055004C0077002B0074007A00340075003300310078007800590066006A006700520073007100620052004A0054002B00590046005600530076004C005000500044004100310031007A0070006200490045007600620073003200430030004C003700550074005500390030005600470073003200370057006C00460052006F004500720066006E00500058005A00690051004400520059003800660061003800450036006E00580048007700730038004A00460065003400330079006A006B0054006C00560077005600630031002F00650055006D0037004B0062005700390070006900380079004F00640069006300530078003800490057004E0061004E0044006C006A007500430062007500350062003700500038006E00450073006600430046006A0057006A00510035005900370067006D003700750057002B007A002F004A0078004C00480077006800590031006F0030004F0057004F0034004A00750037006C00760073002F0032006F00350033006E0052005200780047004400610050004F005100500068003800590062006F007900660052004D004E006E004A00700038006F002F0061002F004300470059002B00690075004700790047003200630043004C0070004F004D0078003100520053004100350067004800770068004B00650057006A0039006B004200440052003600300044006100420064002B004C00550050004F00790039003500570055006800700058006700570051006700780036004F004F00420073004A0075006E00440071004E0055004C006800770036004F00390043006E0065006C0076004E004C0067007300640033004500700056004B0038004A006A00370046004B00490039006D00660030006D007500680033004900320072004800470037006B00500073002F0049006B0049002F00370050005800680058006F006F00760044004500590044005400680064003500560066002F002F005100760050004D0063006C005700300065004700430043004A0063004B002F005A0034006C00690062003500500045006C006F0038004F0053004D0076002B00380030006900590054007200750038006E00450073006600430046006A0057006A00510035005900370067006D003700750057002B007A002F004A0078004C00480077006800590031006F0030004F0057004F0034004A00750037006C00760073002F0079006300530078003800490057004E0061004E0044006C006A00750043006200750035006200370050002F00760076005200310070006F00550079002F004F0051005400540049004F00620068006D00670063002F004B004D00470079002F00590047006B004600730055006B002F007A0041005A006500420072003000390074004D0049004300420057002B005A00540064007300460058007600490066003000700065002F004A0034003D00</DATA></BODY></MYB2B>
';

    $XMLData = mb_convert_encoding($XMLData, "BIG5", "UTF-8");
    //$strReturn = SockPost('http://wisdompay.com.tw/OKCheckCode', $parameter);
    $strReturn = SockPost('http://fuze-pay.com/CathayNotify', $XMLData);
    //$strReturn = SockPost('http://127.0.0.1/fuzePay/CathayNotify', $XMLData);
    //$strReturn = SockPost('https://cn.investing.com/equities/asia-pacific', $parameter);
    echo $strReturn;
    exit;
    /*$ch = curl_init ("https://cn.investing.com/equities/asia-pacific");
    curl_setopt($ch, CURLOPT_HEADER, 0);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_BINARYTRANSFER,1);
    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
    $rawdata=curl_exec ($ch);
    curl_close ($ch);*/

    /*$parameter = array(	
        "d"		=> "715108202019101504414357R0000000000045000010010820101515974  "
    );*/
    //$strReturn = SockPost('http://wisdompay.com.tw/FamilyNotify ', $parameter);
    echo $rawdata;
    /*if (!class_exists('CDbShell'))  		include_once("./BaseClass/CDbShell.php");
    if (!class_exists('CommonElement'))		include_once("./BaseClass/CommonElement.php");
    CDbShell::Connect();
    $ExpectedRecordedDate = CommonElement::CountHoliday("2019-10-10", "2", true);
    echo $ExpectedRecordedDate;
    exit;*/

    /*$xmldata = "<?xml version=\"1.0\" encoding=\"UTF-8\"?> <OLTP> <HEADER> <VER>05.05</VER> <FROM>99027</FROM> <TERMINO>123456011234567890</TERMINO> <TO>廠商統編</TO> <BUSINESS>B000001</BUSINESS> <DATE>20190331</DATE> <TIME>080858</TIME> <STATCODE>0000</STATCODE> <STATDESC /> </HEADER> <AP> <OL_OI_NO>KK1</OL_OI_NO> <PIN_CODE>12345678901234</PIN_CODE> <ORDER_NO>12345678</ORDER_NO> <ACCOUNT>02000</ACCOUNT> <OL_Code_1>123456789</OL_Code_1> <OL_Code_2>1234567890123456</OL_Code_2> <OL_Code_3>123456789012345</OL_Code_3> <STORE_DESC>中山店</STORE_DESC> <STATUS>S</STATUS> <DESC /> </AP> </OLTP>";
    $xml = simplexml_load_string($xmldata);

    echo $xml->HEADER->STATCODE. "<br />";
    echo $xml->AP->ORDER_NO;*/

    function SockPost($URL, $Query){
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $URL);
        curl_setopt($ch, CURLOPT_HEADER, false);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER,true);
        curl_setopt($ch, CURLOPT_POST, 1);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $Query);
        $SSL = (substr($URL, 0, 8) == "https://" ? true : false); 
        if ($SSL) {
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
        }
        $strReturn = curl_exec($ch);
        
        curl_close ($ch);
        
        return $strReturn;
        
    }
?>